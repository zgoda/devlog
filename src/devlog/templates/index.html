{% extends "base.html" %}

{% from "macros/blog.html" import post_url, render_post_headline %}
{% from "macros/menus.html" import tool_dropdown %}

{% block pagetitle %}Devlog {{ gettext('and other logs') }}{% endblock %}

{% block content %}
<div class="content">
  <h1>{{ blog.name }}</h1>
  {% if blog.blurb_html %}
  {{ blog.blurb_html|safe }}
  {% endif %}
  {% if current_user == blog.user %}
  {% set menu_items = [
    (url_for('blog.details', blog_id=blog.id), gettext('edit blog')),
    (url_for('post.create', blog_id=blog.id), gettext('add post')),
    (url_for('blog.import_posts', blog_id=blog.id), gettext('import posts')),
  ] %}
  {{ tool_dropdown(gettext('tools'), menu_items, 'owner-tools-menu') }}
  {% endif %}
  <hr class="is-large">
  <div class="box">
    <h2>{{ gettext('recent posts').capitalize() }}</h2>
    {% for post in posts.items %}
    {{ render_post_headline(post) }}
    {% else %}
    <p>{{ gettext('no posts yet').capitalize() }}.</p>
    {% endfor %}
  </div>
</div>
{% endblock %}

{% block sidebar %}
<div class="card">
  <div class="card-header">
    <h2 class="card-header-title">{{ gettext('recent posts').capitalize() }}</h2>
  </div>
  <div class="card-content">
    {% if recent_posts and recent_posts.count() %}
    <ul>
      {% for post in recent_posts %}
      <li><a href="{{ post_url(post) }}">{{ post.title }}</a> <small>{{ gettext('created on %(date)s', date=format_datetime(post.created, 'short')) }} <a href="{{ url_for('blog.display', blog_id=post.blog_id) }}">{{ gettext('in %(blog)s', blog=post.blog.name) }}</a> {{ gettext('by %(user)s', user=post.author.name) }}</small></li>
      {% endfor %}
    </ul>
    {% else %}
    <div class="content">
      <p>{{ gettext('no posts found') }}</p>
    </div>
    {% endif %}
  </div>
</div>

<div class="card">
  <div class="card-header">
    <h2 class="card-header-title">{{ gettext('recently active blogs').capitalize() }}</h2>
  </div>
  <div class="card-content">
    {% if recent_blogs and recent_blogs.count() %}
    <ul>
      {% for blog in recent_blogs %}
      <li><a href="{{ url_for('blog.display', blog_id=blog.id) }}">{{ blog.name }}</a> <small>{{ gettext('updated %(date)s', date=format_datetime(blog.updated, 'short')) }}</small></li>
      {% endfor %}
    </ul>
    {% else %}
    <div class="content">
      <p>{{ gettext('no blogs found') }}</p>
    </div>
    {% endif %}
  </div>
</div>
{% endblock %}
